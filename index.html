<!DOCTYPE html>
<html>
	<head>kklj
		<!-- Page formatting information -->
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		
		<!-- Include stylesheet for calculator -->
		<link rel="stylesheet" type="text/css" href="calc_styles.css"></link>

		<!-- Include the globals and the  text-to-display file of the relevant language:
			make sure to select "calc_English.js" or "calc_Spanish.js"--> 
			
		<script src="calc_English.js" type="text/javascript"></script>
		<script src="globals.js" type="text/javascript"></script>
		
		<!-- Include jquery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		
		<script>
			document.title = CALC_TITLE; 		// Adds title to calc from calc_Language.js
		</script>
		

	</head>
	<body onload="init();">
		<div id="left_hand_side">
			 
			<h1 id="header"></h1>
			<h3 id="sub_header"></h3>
			<h5 id="instructions"></h5>
			<form id="calc_form" class="form">
				
				<div>			
					<label for="municipality">Choose your municipaliy:</label>
					<select id="municipality" />
						<option value="0">San Miguel de Allende</option>
						<option value="1">Dolores Hidalgo</option>
					</select>
					<div class = "error_lbl">
						<p id="municipality_error">.</p>
					</div>
				</div>
				<div>
					<label for="ppl">Number of people in your household:</label>
					<input type="number" id="ppl" value="1" min="1" max="9999" step="1"/>
					<div class = "error_lbl">
						<p id="ppl_error">.</p>
					</div>
				</div>
				<div>
					<label for="ppl">Length of your roof (meters):</label>
					<input type="number" id="length" value="1" min="0.1" max="99" step="any"/>
					<div class = "error_lbl">
						<p id="length_error">.</p>
					</div>
				</div>
				<div>
					<label for="ppl">Width of your roof (meters):</label>
					<input type="number" id="width" value="1" min="0.1" max="99" step="any"/>
					<div class = "error_lbl">
						<p id="width_error">.</p>
					</div>
				</div>
				<br>
				<div>
					<label>What kind of roof do you have?</label><br>
					<input type="radio" id="cement_roof" name="roof_type" value="0.9" checked>Cement<br>
					<input type="radio" id="sheet_roof" name="roof_type" value="0.8">Corrugated sheet<br>
					<input type="radio" id="spanish_roof" name="roof_type" value="0.7">Spanish Tile
				</div>	
				<br>
				<div>			
					<label for="uses">Select everything you do with water:</label>
					<br>
					<input type="checkbox" class="water_use" id="brush_chk">Brushing your teeth<br>
					<input type="checkbox" class="water_use" id="hands_chk">Washing your hands<br>
					<input type="checkbox" class="water_use" id="garden_chk">Watering a garden
					<div class="extra_input" id="garden_extra">
						<label for="garden_size">How big is your garden? (square meters):</label>
						<input type="number" id="garden_size" value="10" min="0.1" max="9999999999" step="any"/>
					</div><br>
					<input type="checkbox" class="water_use" id="dishes_chk">Washing dishes
					<div class="extra_input" id="dishes_extra">
						<label for="dishes_washing_type">I wash my dishes:</label>
						<select id="dishes_washing_type" />
							<option value="0">By hand</option>
							<option value="1">With a dishwasher</option>
						</select>					
					</div><br>
					<input type="checkbox" class="water_use" id="bath_chk">Bathing<br>
					<input type="checkbox" class="water_use" id="clothes_chk">Laundry
					<div class="extra_input" id="laundry_extra">
						<label for="laundry_type">I do laundry:</label>
						<select id="laundry_type" />
							<option value="0">By hand</option>
							<option value="1">With a laundry machine</option>
						</select>					
					</div><br>
					<input type="checkbox" class="water_use" id="toilet_chk">Flushing the toilet<br>
					<input type="checkbox" class="water_use" id="other_chk">Other
					<div class="extra_input" id="other_extra">
						<label for="other_text">What else do you use water for??</label>
						<input type="text" id="other_text" value=""/>
					</div>
					<div class="extra_input" id="other_extra2">
						<label for="other_value">How much? (Liters per day):</label>
						<input type="number" id="other_value" value="1" min="1" step="any"/>
					</div><br>
					
					
				</div>	
			
				<br>
			</form>
			<div class="button">
				<button>Calculate!</button>
			</div>
			
		</div>
		<div id="right_hand_side">
		</div>
		


		<script>
			
		
			////////////////////////////////////////////////////////////////////
			////						function init() 					////
			//// 															////
			////	Loads the text in the correct language, and sets up 	////
			////	some basic form parameters.	Initializes the form, 		////
			////	stores the starting values in a global, and hides all	////
			////	error messages and extra text that needs to be hidden. 	////
			////////////////////////////////////////////////////////////////////
		
			function init() {
			
				addLanguageText();
				initForm();
				loadStartingValues();
				hideErrorLbls();
				hideExtraText();
				console.log(form);
				
			};
			
			////////////////////////////////////////////////////////////////////
			////				function addLanguageText()					////
			//// 															////
			////	Loads the text in the correct display language.			////
			////////////////////////////////////////////////////////////////////
			
			function addLanguageText(){
				document.getElementById("header").innerHTML = HEADER; 				// Puts the correct language text on the page
				document.getElementById("sub_header").innerHTML = SUB_HEADER;		//	for all elements
				document.getElementById("instructions").innerHTML = INSTRUCTIONS;
			
			}
			
			////////////////////////////////////////////////////////////////////
			////				function initForm()							////
			//// 															////
			////	Initializes the form to not auto-validate so we can 	////
			////	display our own error messages.							////
			////////////////////////////////////////////////////////////////////
			
			function initForm() {
				form = document.getElementById("calc_form");						// Sets the global form so everyone can access it;
				form.noValidate = true;												// Turns off auto-validate so we can self-validate
				form.onchange = validateForm;
				form.onsubmit = validateForm;
			}
			
			////////////////////////////////////////////////////////////////////
			////				function loadStartingValues()				////
			//// 															////
			////	Loads the starting values into a global array.			////
			////////////////////////////////////////////////////////////////////			
				
			function loadStartingValues() {
				allData = {															// initializes the structure of the global, allData 
					municipality: Number(document.getElementById("municipality").value),
					ppl: Number(document.getElementById("ppl").value),				// 	and feeds in initial conditions.
					length: Number(document.getElementById("length").value),
					width: Number(document.getElementById("width").value),
					brush_chk: Boolean(document.getElementById("brush_chk").checked),
					hands_chk: Boolean(document.getElementById("hands_chk").checked),
					garden_chk: Boolean(document.getElementById("garden_chk").checked),
					dishes_chk: Boolean(document.getElementById("dishes_chk").checked),
					bath_chk: Boolean(document.getElementById("bath_chk").checked),
					clothes_chk: Boolean(document.getElementById("clothes_chk").checked),
					toilet_chk: Boolean(document.getElementById("toilet_chk").checked),
					other_chk: Boolean(document.getElementById("other_chk").checked),
					roof_type: Number(document.getElementById("cement_roof").value),
					garden_size: Number(document.getElementById("garden_size").value),
					laundry_type: Number(document.getElementById("laundry_type").value),
					garden_size: Number(document.getElementById("garden_size").value),
					other_text: String(document.getElementById("other_text").value),
					other_value: Number(document.getElementById("other_value").value),
					dishes_washing_type: Number(document.getElementById("dishes_washing_type").value)	
				};
			}	
			
			////////////////////////////////////////////////////////////////////
			////				function hideErrorLbls()					////
			//// 															////
			////	Hides error labels - pretty self-explanatory...			////
			////////////////////////////////////////////////////////////////////
			
			function hideErrorLbls() {
				var lblBoxes = document.getElementsByClassName("error_lbl");		// Turn all label boxes to opacity=0
				for (var i=0; i<lblBoxes.length; i++) {
					lblBoxes[i].style.opacity = 0;				
				};
			}
			
			////////////////////////////////////////////////////////////////////
			////				function hideExtraText()					////
			//// 															////
			////	Hides extra text that's tied to checkbox events			////
			////////////////////////////////////////////////////////////////////
			
			function hideExtraText() {
				var extra_inputs = document.getElementsByClassName("extra_input");		// Turn all label boxes to opacity=0
				for (var i=0; i<extra_inputs.length; i++) {
					extra_inputs[i].style.opacity = 0;				
				};			
			}

			
			////////////////////////////////////////////////////////////////////
			////				function updateInputs() 					////
			//// 															////
			////	Updates the global allData with the most-recently-		////
			////	entered data. 											////
			////////////////////////////////////////////////////////////////////
			
			function updateInputs(el) {
				if (el.type == "checkbox") {
					allData[el.id] = Boolean(el.checked);
				} else if (el.type == "number" | el.type == "select-one") {
					allData[el.id] = Number(el.value)
				} else if (el.type == "text") {
					allData[el.id] = String(el.value)
				} else if (el.type == "radio") {
					allData[el.name] =  el.value;
				};
				calculate(allData);
			}
			
			
			////////////////////////////////////////////////////////////////////
			////	function keydown(event) [Prevent form submit on enter]	////
			//// 															////
			////	checks to see if the key that was pressed was 			////
			////	key #13 (enter/return). If so, it prevents the default 	////
			////	behavior of submitting the form. That way, we never 	////
			////	send the data anywhere, just calculate some stuff with 	////
			////	it here. 												////		
			////////////////////////////////////////////////////////////////////

			
			$(document).ready(function() {
				$(window).keydown(function(event){
					if(event.keyCode == 13) {
					event.preventDefault();
					return false;
					}
				});
			});
			
			////////////////////////////////////////////////////////////////////
			////	function keypress(event) [check validity of keystroke]	////
			//// 															////
			////	checks to see if the key that was pressed was 			////
			////	a valid key. If not, doesn't allow keypress.			////		
			////////////////////////////////////////////////////////////////////
			
			$('input').bind('keypress', function (event) {
				if (event.target.type == "number") { 								// If it's being entered in a numeric field
					if (!numAcceptableKeys.includes(event.originalEvent.key)) { 	// If the key isn't a number or a movement key
						event.preventDefault(); 									// 	prevent behavior
						return false;		
					} else {
						return true;
					};
				} else { 							// If the field isn't a number, allow all behavior.
					return true;
				};	
			});
			
			////////////////////////////////////////////////////////////////////
			////				function validateForm(event)				////
			//// 															////
			////	When an event occurs, validates the event target. For 	////
			////	example, if a value is entered into a numberic input,	////
			////	this function validates that particular input. At the 	////
			////	end, it updates the global data. If the entry was 		////
			////	invalid it throws an error message, replaces the value,	////
			////	then loads the data.									////		
			////////////////////////////////////////////////////////////////////
			
			function validateForm(event) {
				 // fetch cross-browser event object and form node
				
				event = (event ? event : window.event);
				var element = (event.target ? event.target : event.srcElement);
				var rets = customValid(element);
				var valid = rets[0];
				var errMsg = rets[1];
				if (valid){
					updateInputs(element);
				} else {
					var errorText = document.getElementById(element.id+"_error");
					var errorBox = errorText.parentElement;
					errorText.innerHTML = errMsg;
					fadeIn(errorBox);
					setTimeout(function(){fadeOut(errorBox)}, ERROR_DISPLAY_TIME);
					element.validity.valid = false;
					updateInputs(element);
				};	
			}
			
			////////////////////////////////////////////////////////////////////
			////					fucntion customValid(el)				////
			//// 															////
			////	Takes an element, el, and validates it based on certain	////
			////	preset rules. Returns:									////
			////		[valid (boolean), errorMsg (string)]				////
			////////////////////////////////////////////////////////////////////
			
			
			function customValid(el) {
				var valid = true;
				var value = Number(el.value);
				var errorMsg = "";
				if (el.id == "ppl") {
					if (value < el.min)	{
						valid = false;
						errorMsg = PPL_MIN_E1+el.min+PPL_MIN_E2;
						el.value = el.min;
					} else if (value > el.max) {
						valid = false;
						errorMsg = PPL_MAX_E1+el.max+PPL_MAX_E2;
						el.value = el.max;
					} else if (value % 1 != 0 & el.id == "ppl") {
						valid = false;
						errorMsg = PPL_DECIMAL_E;
						el.value = parseInt(value, 10);
					};
				return [valid, errorMsg];
				} else if (el.id == "length" | el.id == "width") {
					if (value < el.min) {
						valid = false;
						errorMsg = SIZE_MIN_E1;
						el.value = el.min;
					} else if (value > el.max) {
						valid = false;
						errorMsg = SIZE_MAX_E1+el.max+SIZE_MAX_E2;
						el.value = el.max;
					};
					return [valid, errorMsg];
				} else {
				return [valid, errorMsg];
				};
			}
			
			////////////////////////////////////////////////////////////////////
			////				functions fadeIn(el), fadeOut(el) 			////
			//// 															////
			////	Fades in or out the passed element by adjusting the 	////
			////	the div element's opacity in steps. Many thanks to:		////////////////////
			////	http://www.chrisbuttery.com/articles/fade-in-fade-out-with-javascript/ 	////	
			////	for this simple and lovely bit of js. Cheers! 							////
			////	If the div is visible, fadeIn does nothing. If it's not, fade out 		////	
			////	does nothing. 															////
			////////////////////////////////////////////////////////////////////////////////////
			
			function fadeOut(el){ 
				(function fade() {
					if ((el.style.opacity -= .075) < 0) {
					el.style.opacity = 0;
					} else {
					requestAnimationFrame(fade);
					}
				})();
			}
			
			function fadeIn(el){
				(function fade() {
					var val = parseFloat(el.style.opacity);
					if (!((val += .025) > 1)) {
					el.style.opacity = val;
					requestAnimationFrame(fade);
					}
				})();
			}
			
			////////////////////////////////////////////////////////////////////
			////				function that executes every time 			////
			////				a checkbox is checked or unchecked 			////
			//// 															////
			////	Opens up the appropriate extra entry boxes depending on ////
			//// 	which checkbox is checked. 								////
			////////////////////////////////////////////////////////////////////
			
			$(':checkbox').change(function(event){
				var el = event.target;
				if (el.id == "garden_chk"){ 		// Open input field to get garden size
					if (el.checked) {
						fadeIn(document.getElementById("garden_extra"));
					} else {
						fadeOut(document.getElementById("garden_extra"));
					};
				} else if (el.id == "other_chk") { 	// Open input fields to get other info
					if (el.checked) {
						fadeIn(document.getElementById("other_extra"));
						fadeIn(document.getElementById("other_extra2"));
					} else {
						fadeOut(document.getElementById("other_extra"));
						fadeOut(document.getElementById("other_extra2"));
					};
				} else if (el.id == "dishes_chk") { // open input field to get type of dish washing
					if (el.checked) {
						fadeIn(document.getElementById("dishes_extra"));
					} else {
						fadeOut(document.getElementById("dishes_extra"));
					};
				} else if (el.id == "clothes_chk") { // open input field to get type of laundry
					if (el.checked) {
						fadeIn(document.getElementById("laundry_extra"));
					} else {
						fadeOut(document.getElementById("laundry_extra"));
					};
				
				};
			});
			
			function calculate(inputs) {
			
				console.log(inputs);
			
			}
     
		</script>
	</body>
</html>
