<!DOCTYPE html>
<html>
	<head>
		<!-- Page formatting information -->
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<meta name="Author" content="Chantal Kronenburg & Aaron Krupp, Caminos de Agua"/>
		<!-- Include Leaflet libraries (through carto) including leaflet label plugin -->
		<link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css"></link>
		<script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script>
		<script src="https://leaflet.github.io/Leaflet.label/leaflet.label.js"></script> <!-- files necessary for labels in leaflet -->
		<!-- Include jquery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<!-- Include both libraries for plotting stamen basemaps --> 
		<script type="text/javascript" src="https://stamen-maps.a.ssl.fastly.net/js/tile.stamen.js"></script>
		<!-- Include stuff required for easy full-screen option --> 
		<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
		<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />
		<!-- Include stylesheets for calculator and map -->
		<link rel="stylesheet" type="text/css" href="calc_styles.css"></link>
		<link rel="stylesheet" type="text/css" href="rainmap_styles.css"></link>
		<!-- Include globals for calc and rainmap and scripts for rainmap -->
		<script src="globals.js" type="text/javascript"></script>
		<script src="rainmap_global.js" type="text/javascript" /></script>
		
		
		<!-- ----------- MAKE LANGUAGE CHANGES HERE!!! ------------- -->
		<!-- Include text-to-display file of the relevant language:
			make sure to select "calc_English.js" or "calc_Spanish.js"
			and the same for the rainmap files. --> 	
		<script src="calc_English.js" type="text/javascript"></script>
		<script src="rainmap_display_English.js" type="text/javascript"></script>
		<!------------------------------------------------------------->
		
		<script src="rainmap_scripts.js" type="text/javascript" /></script>
		
		<script>
			document.title = CALC_TITLE; 		// Adds title to calc from calc_Language.js
		</script>
		

	</head>
	<body onload="init();">
	
		<!-- Left hand side (inputs) for the calculator -->
		<div id="left_hand_side">
			<div id="LHS_inputs">
				<!-- the top text goes here -->
				<a id="caminos_logo" href="https://www.caminosdeaguamexico.org" target="_blank">
					<img class="caminos_logo_img" src="https://dl.dropboxusercontent.com/s/ligsjij2ka26gi0/caminos_logo_circle.png"></img>
				</a>
				<h1 class="headers" id="header"></h1>
				<h3 class="headers" id="sub_header"></h3>
				<p class="headers" id="instructions"></p>
				
				<!-- start the form!!! -->
				
					<!-- Select your municipality -->
					<div style="position: relative; float: left;">
						<label for="municipality" id="muni0" ></label><br>
						<div id="WaterMap"></div>
					</div>
					
					<!-- How many people in your household? -->
					
					<div id="fill_in">
						<form id="calc_form" class="form">
						<div>
							<label for="ppl" id="ppl0"></label>
							<input type="number" id="ppl" value="1" min="1" max="9999" step="1"/>
							<div class = "error_lbl">
								<p id="ppl_error">.</p>
							</div>
						</div>
						
						<!-- Length of your roof -->
						<div>
							<label for="length" id = "length0"></label>
							<input type="number" id="length" value="1" min="0.1" max="99" step="any"/>
							<div class = "error_lbl">
								<p id="length_error">.</p>
							</div>
						</div>
						
						<!-- Width of your roof -->
						<div>
							<label for="width" id = "width0"></label>
							<input type="number" id="width" value="1" min="0.1" max="99" step="any"/>
							<div class = "error_lbl">
								<p id="width_error">.</p>
							</div>
						</div>
						<br>
						<!-- Type of roof -->
						<div>
							<label id="roof0"></label><br>
							<input type="radio" id="cement_roof" name="roof_type" value="0" checked>.<br>
							<input type="radio" id="sheet_roof" name="roof_type" value="1">.<br>
							<input type="radio" id="spanish_roof" name="roof_type" value="2">.
						</div>	
						<br> 	
					<br>
				</form>
				<!-- When you press this button, it stops letting you edit the form 
						and displays the inputs back to the user -->
				<div class="button">
					<button onclick="replace('LHS_inputs','LHS_display'); widthShift(); " id="calc_button"></button>
				</div>
				</div>
				
				
			</div>
			<div id="LHS_display">
				<h1 id="header_display"></h1>
				<h3 id="sub_header_display"></h3>
				<p id="instructions_display"></p>
				<div class="to_indent">					
					<p name="display_text">.</p>
					<p name="display_text">.</p>
					<p name="display_text">.</p>
					<p name="display_text">.</p>
					<br><br>
					<div class="button" align="center">
						<button onclick="replace('LHS_display','LHS_inputs'); widthShift()" id="back2inputs_button" ></button>
					</div>
				</div>
			</div>
		</div>
		
		<!-- The right hand side displays the calculated resullts in simple or complex form -->
		<div id="right_hand_side" align="center">
			<div class="footer" align="right"></div>
			<div id="results_header" class="results_headers"></div>
			<div class="tooltip" id="yes_or_no" name="yes_or_no" onmouseover="addTooltipText(this)">
				<span class="tooltiptext"></span>
				<label name="yes_or_no_lbl"></label><br>
				<label name="yes_or_no_numb" class="return_num"></label><br>
				<label name="yes_or_no_lbl"></label><br>
			</div>
			<div id="min_header" class="results_headers"></div>
			<div class="outer_row" id="top_box">
				
				<div class="tooltip" id="left" name="min_roof" onmouseover="addTooltipText(this)">
					<span class="tooltiptext"></span>
					<br id='spacing0'><label name="min_roof_lbl"></label><br id='spacing1'>
					<label name="min_roof_numb" class="return_num"></label><br id='spacing2'>
					<label name="min_roof_lbl"></label>
				</div>
					
				<div class="tooltip" id="right" name="min_tank" onmouseover="addTooltipText(this)">
					<span class="tooltiptext"></span>
					<br id='spacing3'><label name="min_tank_lbl"></label><br id='spacing4'>
					<label name="min_tank_numb" class="return_num"></label><br id='spacing5'>
					<label name="min_tank_lbl"></label><br>
				</div>
			</div>
			<div id="real_header" class="results_headers"></div>
			<div class="outer_row" id="bottom_box">
				<div class="tooltip" id="left" name="real_roof" onmouseover="addTooltipText(this)">
					<span class="tooltiptext"></span>
					<br id='spacing6'><label name="real_roof_lbl"></label><br id='spacing7'>
					<label name="real_roof_numb" class="return_num"></label><br id='spacing8'>
					<label name="real_roof_lbl"></label><br>
				</div>
					
				<div class="tooltip" id="right" name="real_tank" onmouseover="addTooltipText(this)">
					<span class="tooltiptext"></span>
					<br id='spacing9'><label name="real_tank_lbl"></label><br id='spacing10'>
					<label name="real_tank_numb" class="return_num"></label><br id='spacing11'>
					<label name="real_tank_lbl"></label><br>
				</div>
			</div>
				
				
				
			<a id="caminos_logo2" href="https://www.caminosdeaguamexico.org" target="_blank">
				<img class="caminos_logo_img" src="https://dl.dropboxusercontent.com/s/ligsjij2ka26gi0/caminos_logo_circle.png"></img>
			</a>	
			<!--</div>-->
								
		</div>
		

		
		<script>
			
		
			////////////////////////////////////////////////////////////////////
			////						function init() 					////
			//// 															////
			////	Loads the text in the correct language, and sets up 	////
			////	some basic form parameters.	Initializes the form, 		////
			////	stores the starting values in a global, and hides all	////
			////	error messages and extra text that needs to be hidden. 	////
			////////////////////////////////////////////////////////////////////
		
			function init() {
			
				initForm();
				initEmbeddedMap();							
				
				
				hideErrorLbls();
				hideExtraText();
				hideComplexOutput();
				
				setTimeout(function() {
					loadStartingValues();
					displayStuff = inputs2outputs(allData);
					displayOutputs(displayStuff);
					addLanguageText();
				}, 1000)
				
				
				
				startInterrupt();
				
				
				
			};
			
			////////////////////////////////////////////////////////////////////
			////				function addLanguageText()					////
			//// 															////
			////	Loads the text in the correct display language.			////
			////////////////////////////////////////////////////////////////////
			
			function addLanguageText(){
				//var clone = $('#essential_use0').html();
				//$('#essential_use1').html(clone);
				//$('#essential_use2').html(clone);
				//var clone = $('#tank_size0').html();
				//$('#tank_size1').html(clone);
				//$('#tank_size2').html(clone);
				//var clone = $('#total_use0').html();
				//$('#total_use1').html(clone);
				//var clone = $('#inventory_table0').html();
				//$('#inventory_table1').html(clone);
				
				document.getElementById("header").innerHTML = HEADER; 				// Puts the correct language text on the page
				document.getElementById("sub_header").innerHTML = SUB_HEADER;		//	for all elements
				document.getElementById("instructions").innerHTML = INSTRUCTIONS;
				document.getElementById("muni0").innerHTML = MUNI0_LBL;
				document.getElementById("ppl0").innerHTML = PPL0_LBL;
				document.getElementById("length0").innerHTML = LENGTH0_LBL;
				document.getElementById("width0").innerHTML = WIDTH0_LBL;
				document.getElementById("roof0").innerHTML = ROOF0_LBL;
				document.getElementById("cement_roof").nextSibling.data = CEMENT_ROOF_LBL;
				document.getElementById("sheet_roof").nextSibling.data = SHEET_ROOF_LBL;
				document.getElementById("spanish_roof").nextSibling.data = SPANISH_ROOF_LBL;
				
				//document.getElementById("uses0").innerHTML = USES0_LBL;
				//document.getElementById("brush_chk").nextSibling.data = BRUSH_CHK_LBL;
				//document.getElementById("hands_chk").nextSibling.data = HANDS_CHK_LBL;
				//document.getElementById("garden_chk").nextSibling.data = GARDEN_CHK_LBL;
				//document.getElementById("dishes_chk").nextSibling.data = DISHES_CHK_LBL;
				//document.getElementById("bath_chk").nextSibling.data = BATH_CHK_LBL;
				//document.getElementById("clothes_chk").nextSibling.data = CLOTHES_CHK_LBL;
				//document.getElementById("toilet_chk").nextSibling.data = TOILET_CHK_LBL;
				//document.getElementById("other_chk").nextSibling.data = OTHER_CHK_LBL;
				//document.getElementById("garden_extra1").innerHTML = GARDEN_EXTRA1_LBL;
				//document.getElementById("dishes_extra1").innerHTML = DISHES_EXTRA1_LBL;
				//document.getElementById("dishes_extra1_val0").innerHTML = DISHES_EXTRA1_VAL0_LBL;
				//document.getElementById("dishes_extra1_val1").innerHTML = DISHES_EXTRA1_VAL1_LBL;
				//document.getElementById("laundry_extra1").innerHTML = LAUNDRY_EXTRA1_LBL;
				//document.getElementById("laundry_extra1_val0").innerHTML = LAUNDRY_EXTRA1_VAL0_LBL;
				//document.getElementById("laundry_extra1_val1").innerHTML = LAUNDRY_EXTRA1_VAL1_LBL;
				//document.getElementById("other_extra1").innerHTML = OTHER_EXTRA1_LBL; 
				//document.getElementById("other_extra3").innerHTML = OTHER_EXTRA3_LBL;
				//document.getElementById("table_lbl").innerHTML = TABLE_LBL;
				document.getElementById("calc_button").innerHTML = CALC_BUTTON_LBL;
				document.getElementById("back2inputs_button").innerHTML = BACK2INPUTS_BUTTON_LBL;
				document.getElementById("header_display").innerHTML = HEADER;
				document.getElementById("sub_header_display").innerHTML = LHS_DISPLAY_TITLE;
				document.getElementById("instructions_display").innerHTML = LHS_INSTRUCTIONS;

				
				var els = document.getElementsByClassName("footer") 
				for (var i=0; i<els.length; i++) {
					els[i].innerHTML = FOOTER_TXT;
				};
				
				//var els = document.getElementsByName("table_lbl") 
				//for (var i=0; i<els.length; i++) {
				//	els[i].innerHTML = TABLE_LBL;
				//};
				
				var els = document.getElementsByClassName("res_title") 
				for (var i=0; i<els.length; i++) {
					els[i].innerHTML = RHS_TITLE;
				};
				
				//var els = document.getElementsByName("essential_use_lbl0") 
				//for (var i=0; i<els.length; i++) {
				//	els[i].innerHTML = ESSENTIAL_USE_LBL0;
				//};
				
				//var els = document.getElementsByName("essential_use_lbl1") 
				//for (var i=0; i<els.length; i++) {
				//	els[i].innerHTML = ESSENTIAL_USE_LBL1;
				//};
				
				//var els = document.getElementsByName("total_use_lbl0") 
				//for (var i=0; i<els.length; i++) {
				//	els[i].innerHTML = TOTAL_USE_LBL0;
				//};
				
				//var els = document.getElementsByName("total_use_lbl1") 
				//for (var i=0; i<els.length; i++) {
				//	els[i].innerHTML = TOTAL_USE_LBL1;
				//};
				
				//var els = document.getElementsByName("tank_size_lbl0") 
				//for (var i=0; i<els.length; i++) {
				//	els[i].innerHTML = TANK_SIZE_LBL0;
				//};
				//
				//var els = document.getElementsByName("tank_size_lbl1") 
				//for (var i=0; i<els.length; i++) {
				//	els[i].innerHTML = TANK_SIZE_LBL1;
				//}
				//
				//
				//
				//
				//var els = document.getElementsByName("table_titles")
				//for (var i=0; i<els.length; i++) {
				//	
				//	els[i].innerHTML = TABLE_TITLES[i % TABLE_TITLES.length];
				//};
				//
				//var els = document.getElementsByName("month")
				//for (var i=0; i<els.length; i++) {
				//	
				//	els[i].innerHTML = MONTHS[i % MONTHS.length];
				//};
				
				updateOutputText(); 
				
			}
			
			////////////////////////////////////////////////////////////////////
			////				function initForm()							////
			//// 															////
			////	Initializes the form to not auto-validate so we can 	////
			////	display our own error messages.							////
			////////////////////////////////////////////////////////////////////
			
			function initForm() {
				form = document.getElementById("calc_form");						// Sets the global form so everyone can access it;
				form.noValidate = true;												// Turns off auto-validate so we can self-validate
				form.onchange = validateForm;
				form.onsubmit = validateForm;
			}
			
			////////////////////////////////////////////////////////////////////
			////				function loadStartingValues()				////
			//// 															////
			////	Loads the starting values into a global array.			////
			////////////////////////////////////////////////////////////////////			
				
			function loadStartingValues() {
				allData = {															// initializes the structure of the global, allData 
					place: mun,
					municipality_name: MUN_STARTING_VALUE,
					station_name: STATION_STARTING_VALUE,
					ppl: Number(document.getElementById("ppl").value),				// 	and feeds in initial conditions.
					length: Number(document.getElementById("length").value),
					width: Number(document.getElementById("width").value),
					roof_type: 0
					//brush_chk: Boolean(document.getElementById("brush_chk").checked),
					//hands_chk: Boolean(document.getElementById("hands_chk").checked),
					//garden_chk: Boolean(document.getElementById("garden_chk").checked),
					//dishes_chk: Boolean(document.getElementById("dishes_chk").checked),
					//bath_chk: Boolean(document.getElementById("bath_chk").checked),
					//clothes_chk: Boolean(document.getElementById("clothes_chk").checked),
					//toilet_chk: Boolean(document.getElementById("toilet_chk").checked),
					//other_chk: Boolean(document.getElementById("other_chk").checked),
					//roof_type: Number(document.getElementById("cement_roof").value),
					//garden_size: Number(document.getElementById("garden_size").value),
					//laundry_type: Number(document.getElementById("laundry_type").value),
					//garden_size: Number(document.getElementById("garden_size").value),
					//other_text: String(document.getElementById("other_text").value),
					//other_value: Number(document.getElementById("other_value").value),
					//dishes_washing_type: Number(document.getElementById("dishes_washing_type").value)	
				};
				
				els = document.getElementsByName("roof_type");
				for (var i=0; i<els.length; i++) {
					if(els[i].checked) {allData.roof_type = els[i].value}
				}
			}	
			
			////////////////////////////////////////////////////////////////////
			////				function hide stuff functions				////
			//// 															////
			////	Hides error labels - pretty self-explanatory...			////
			////////////////////////////////////////////////////////////////////
			
			function hideErrorLbls() {
				var lblBoxes = document.getElementsByClassName("error_lbl");		// Turn all label boxes to opacity=0
				for (var i=0; i<lblBoxes.length; i++) {
					lblBoxes[i].style.opacity = 0;				
				};
			}
			
			function hideExtraText() {
				var extra_inputs = document.getElementsByClassName("extra_input");		// Turn all label boxes to opacity=0
				for (var i=0; i<extra_inputs.length; i++) {
					extra_inputs[i].style.opacity = 0;				
				};			
			}
			
			function hideComplexOutput() {
				document.getElementById("LHS_display").style.opacity = 0;
				document.getElementById("LHS_display").hidden = true;
			}

			
			////////////////////////////////////////////////////////////////////
			////				function updateInputs() 					////
			//// 															////
			////	Updates the global allData with the most-recently-		////
			////	entered data. 											////
			////////////////////////////////////////////////////////////////////
			
			function updateInputs(el) {
				if (el.type == "checkbox") {
					allData[el.id] = Boolean(el.checked);
				} else if (el.type == "number" | el.type == "select-one") {
					allData[el.id] = Number(el.value)
				} else if (el.type == "text") {
					allData[el.id] = String(el.value)
				} else if (el.type == "radio") {
					allData[el.name] =  el.value;
				} 
				
				// Update the location regardless, to patch the fact that the automatic
				//	location isn't read in b/c the geoJSON is loaded asynchronously...
				allData.municipality_name = String(geojson._layers[mun].feature.properties.NOMGEO);	
				allData.station_name = String(geojson._layers[mun].feature.properties.Station);	
				allData.place = mun;
				
				updateOutputText();						// update the text on the LHS output page
				displayStuff = inputs2outputs(allData); // calculate!
				displayOutputs(displayStuff); 			// display the calcuated values on the RHS!
				
			}
			
			

			
			////////////////////////////////////////////////////////////////////
			////				function updateOutputText() 				////
			//// 															////
			////	Updates the text that's displayed on the LHS display	////
			////	screen after the user submits the form.					////
			////////////////////////////////////////////////////////////////////
			
			
			function updateOutputText() {
				DISPLAY_TXT[0] = MUN_TXT[0]+allData.municipality_name+MUN_TXT[1]; 	// Display municipality message
				if (allData.ppl > 1) { 													// Parse person (1) or people (>1)
					DISPLAY_TXT[1] = PPL_TXT[0]+allData.ppl+PPL_TXT[2];
				} else {
					DISPLAY_TXT[1] = PPL_TXT[0]+allData.ppl+PPL_TXT[1];
				}
				DISPLAY_TXT[2] = LEN_WID_TXT[0]+allData.length+LEN_WID_TXT[1]+allData.width+LEN_WID_TXT[2];
				DISPLAY_TXT[3] = ROOF_TYPE_TXT[0]+ROOF_TYPES[allData.roof_type]+ROOF_TYPE_TXT[1];
				
				var els = document.getElementsByClassName("water_use"); 	// Display all other water uses. 
				//DISPLAY_TXT[4] = USE_TXT[0];
				//var counter = 0;
				//for (var i=0; i<els.length; i++) {
				//	if (els[i].checked) {
				//		counter++;
				//		DISPLAY_TXT[4] = DISPLAY_TXT[4] + "<br>\xa0\xa0\xa0\xa0&#8226;\xa0" + USES[i]
				//	}
				//}
				//if (counter==0) {
				//	DISPLAY_TXT[4] = DISPLAY_TXT[4] + "<br>\xa0\xa0\xa0\xa0" + NO_USE;
				//}
				
				var els = document.getElementsByName("display_text"); 		// Actually update all the <p> elements
				for (var i=0; i<els.length; i++) {
					els[i].innerHTML = DISPLAY_TXT[i];
				};
			}
			
			////////////////////////////////////////////////////////////////////
			////	function keydown(event) [Prevent form submit on enter]	////
			//// 															////
			////	checks to see if the key that was pressed was 			////
			////	key #13 (enter/return). If so, it prevents the default 	////
			////	behavior of submitting the form. That way, we never 	////
			////	send the data anywhere, just calculate some stuff with 	////
			////	it here. 												////		
			////////////////////////////////////////////////////////////////////

			
			$(document).ready(function() {
				$(window).keydown(function(event){
					if(event.keyCode == 13) {
					event.preventDefault();
					return false;
					}
				});
			});
			
			////////////////////////////////////////////////////////////////////
			////	function keypress(event) [check validity of keystroke]	////
			//// 															////
			////	checks to see if the key that was pressed was 			////
			////	a valid key. If not, doesn't allow keypress.			////		
			////////////////////////////////////////////////////////////////////
			
			$('input').bind('keypress', function (event) {
				if (event.target.type == "number") { 								// If it's being entered in a numeric field
					if (!numAcceptableKeys.includes(event.originalEvent.key)) { 	// If the key isn't a number or a movement key
						event.preventDefault(); 									// 	prevent behavior
						return false;		
					} else {
						return true;
					};
				} else { 							// If the field isn't a number, allow all behavior.
					return true;
				};	
			});
			
			////////////////////////////////////////////////////////////////////
			////				function validateForm(event)				////
			//// 															////
			////	When an event occurs, validates the event target. For 	////
			////	example, if a value is entered into a numberic input,	////
			////	this function validates that particular input. At the 	////
			////	end, it updates the global data. If the entry was 		////
			////	invalid it throws an error message, replaces the value,	////
			////	then loads the data.									////		
			////////////////////////////////////////////////////////////////////
			
			function validateForm(event) {
				
				// fetch cross-browser event object and form node
				
				event = (event ? event : window.event);
				var element = (event.target ? event.target : event.srcElement);
				var rets = customValid(element);
				var valid = rets[0];
				var errMsg = rets[1];
				if (valid){
					updateInputs(element);
				} else {
					var errorText = document.getElementById(element.id+"_error");
					var errorBox = errorText.parentElement;
					errorText.innerHTML = errMsg;
					fadeIn(errorBox);
					setTimeout(function(){fadeOut(errorBox, false)}, ERROR_DISPLAY_TIME);
					element.validity.valid = false;
					updateInputs(element);
				};	
			}
			
			////////////////////////////////////////////////////////////////////
			////					fucntion customValid(el)				////
			//// 															////
			////	Takes an element, el, and validates it based on certain	////
			////	preset rules. Returns:									////
			////		[valid (boolean), errorMsg (string)]				////
			////////////////////////////////////////////////////////////////////
			
			
			function customValid(el) {
				var valid = true;
				var value = Number(el.value);
				var errorMsg = "";
				if (el.id == "ppl") {
					if (value < el.min)	{
						valid = false;
						errorMsg = PPL_MIN_E1+el.min+PPL_MIN_E2;
						el.value = el.min;
					} else if (value > el.max) {
						valid = false;
						errorMsg = PPL_MAX_E1+el.max+PPL_MAX_E2;
						el.value = el.max;
					} else if (value % 1 != 0 & el.id == "ppl") {
						valid = false;
						errorMsg = PPL_DECIMAL_E;
						el.value = parseInt(value, 10);
					};
				return [valid, errorMsg];
				} else if (el.id == "length" | el.id == "width") {
					if (value < el.min) {
						valid = false;
						errorMsg = SIZE_MIN_E1;
						el.value = el.min;
					} else if (value > el.max) {
						valid = false;
						errorMsg = SIZE_MAX_E1+el.max+SIZE_MAX_E2;
						el.value = el.max;
					};
					return [valid, errorMsg];
				} else {
				return [valid, errorMsg];
				};
			}
			
			////////////////////////////////////////////////////////////////////
			////				functions fadeIn(el), fadeOut(el) 			////
			//// 															////
			////	Fades in or out the passed element by adjusting the 	////
			////	the div element's opacity in steps. Many thanks to:		////////////////////
			////	http://www.chrisbuttery.com/articles/fade-in-fade-out-with-javascript/ 	////	
			////	for this simple and lovely bit of js. Cheers! 							////
			////	If the div is visible, fadeIn does nothing. If it's not, fade out 		////	
			////	does nothing. 															////
			////////////////////////////////////////////////////////////////////////////////////
			
			function fadeOut(el, hide){ 
				(function fade() {
					if ((el.style.opacity -= .09) < 0) {
					el.style.opacity = 0;
					} else {
					requestAnimationFrame(fade);
					}
				})();

				if (hide) {
					el.hidden = true;
				};
			}
			
			function fadeIn(el){
				
				el.style.opacity = 0;
				el.hidden = false; 
				
				(function fade() {
					var val = parseFloat(el.style.opacity);
					if (!((val += .075) > 1)) {
					el.style.opacity = val;
					requestAnimationFrame(fade);
					}
				})();
				
			}
			
			////////////////////////////////////////////////////////////////////
			////				function that executes every time 			////
			////				a checkbox is checked or unchecked 			////
			//// 															////
			////	Opens up the appropriate extra entry boxes depending on ////
			//// 	which checkbox is checked. 								////
			////////////////////////////////////////////////////////////////////
			
			$(':checkbox').change(function(event){
				var el = event.target;
				if (el.id == "garden_chk"){ 		// Open input field to get garden size
					if (el.checked) {
						fadeIn(document.getElementById("garden_extra"));
					} else {
						fadeOut(document.getElementById("garden_extra"), false);
					};
				} else if (el.id == "other_chk") { 	// Open input fields to get other info
					if (el.checked) {
						fadeIn(document.getElementById("extra_house0"));
						fadeIn(document.getElementById("other_extra"));
						fadeIn(document.getElementById("other_extra2"));
					} else {
						fadeOut(document.getElementById("extra_house0"), false);
						fadeOut(document.getElementById("other_extra"), false);
						fadeOut(document.getElementById("other_extra2"), false);
					};
				} else if (el.id == "dishes_chk") { // open input field to get type of dish washing
					if (el.checked) {
						fadeIn(document.getElementById("dishes_extra"));
					} else {
						fadeOut(document.getElementById("dishes_extra", false));
					};
				} else if (el.id == "clothes_chk") { // open input field to get type of laundry
					if (el.checked) {
						fadeIn(document.getElementById("laundry_extra"));
					} else {
						fadeOut(document.getElementById("laundry_extra"), false);
					};
				
				};
			});
			
			////////////////////////////////////////////////////////////////////
			////			--- BUG FIX FOR QUICK CHECKBOX CLICK --- 		////	
			////				function startInterrupt()					////
			//// 															////
			////	When a checkbox is clicked off-on-off rapidly, the	 	////
			////	extra text fades in, out, then in again, displaying 	////
			////	when it shouldn't be. These two functions are a patch	////
			////	over that bug. Every INTERRUPT_INTERVAL, this function 	////
			////	interrupts the code and checks all the checkboxes. If 	////
			////	they aren't checked, it makes sure that their 			////
			////	corresponding extra info boxes are hidden. This patch,	////
			////	as with most patches, isn't perfect. There's still a 	////
			////	half second or so where the label box pops up. Se lavi.	////
			////////////////////////////////////////////////////////////////////

			
			function startInterrupt() {
				var myInterval = setInterval( "hideUncheckedLbls()", INTERRUPT_INTERVAL);  // run
			}
			
			function hideUncheckedLbls() {
				els = document.getElementsByClassName("water_use");
				for (var i=0; i<els.length; i++) {	
					if (!els[i].checked) {
						els[i].nextElementSibling.style.opacity = 0;
					};
				};
			}
			
			////////////////////////////////////////////////////////////////////
			////			function showComplex()	/ showSimple() 			////
			//// 															////
			////	Hides one RHS panel and shows the other.				////
			////////////////////////////////////////////////////////////////////
			
			function replace(e2hide, e2show) {
				fadeOut(document.getElementById(e2hide), true);
				fadeIn(document.getElementById(e2show));
			}

			
			////////////////////////////////////////////////////////////////////
			////			function displayOutputs				 			////
			//// 															////
			////	Takes the calculated outputs and displays them on the	////
			////	right hand side panel. 									////
			////////////////////////////////////////////////////////////////////
			
			
			function displayOutputs(o) {
				document.getElementById("results_header").innerHTML = RESULTS_HEADER;
				document.getElementById("min_header").innerHTML = MIN_HEADER;
				document.getElementById("real_header").innerHTML = REAL_HEADER;
				
				var ie = false;
				if (navigator.appName == 'Microsoft Internet Explorer' ||  !!(navigator.userAgent.match(/Trident/) || navigator.userAgent.match(/rv 11/))) {
					ie = true;
				}
				
				el = document.getElementById("yes_or_no");
				var elNumb=document.getElementsByName("yes_or_no_numb")[0];
				if (o.minRoofArea <= o.actualRoofArea) {
					el.style.backgroundColor = GREEN;
					elNumb.innerHTML = ADEQUATE_LBL;
					document.getElementById("bottom_box").style.display = "inline-block"
					document.getElementById("real_header").style.display = "inline-block"
					document.getElementById("top_box").style.marginBottom = "0px";
				} else {
					el.style.backgroundColor = RED;
					elNumb.innerHTML = INADEQUATE_LBL;
					document.getElementById("bottom_box").style.display = "none"
					document.getElementById("real_header").style.display = "none"
					document.getElementById("top_box").style.marginBottom = "125px";
				}
				
				document.getElementsByName("min_roof_numb")[0].innerHTML = String(Math.round(o.minRoofArea))		// fill in numbers rounded to nearest int.
				document.getElementsByName("min_tank_numb")[0].innerHTML = String(Math.round(o.minTankVolume))
				document.getElementsByName("real_roof_numb")[0].innerHTML = String(Math.round(o.actualRoofArea))
				document.getElementsByName("real_tank_numb")[0].innerHTML = String(Math.round(o.actualTankVolume))
				
				var els=document.getElementsByName("yes_or_no_lbl");
				for (var i=0; i<els.length; i++) {
					els[i].innerHTML = YES_OR_NO_LBL[i];
					if (i>0) {
						els[i].innerHTML = YES_OR_NO_LBL[1]+" <b><big>"+String(o.essentialDailyUse)+"</b></big> "+YES_OR_NO_LBL[2]
					}
				}
				
				var els=document.getElementsByName("min_roof_lbl");
				for (var i=0; i<els.length; i++) {
					els[i].innerHTML = MIN_ROOF_LBL[i];
				}
				
				var els=document.getElementsByName("min_tank_lbl");
				for (var i=0; i<els.length; i++) {
					els[i].innerHTML = MIN_TANK_LBL[i];
				}
				
				var els=document.getElementsByName("real_roof_lbl");
				for (var i=0; i<els.length; i++) {
					els[i].innerHTML = REAL_ROOF_LBL[i];
				}
				
				var els=document.getElementsByName("real_tank_lbl");
				for (var i=0; i<els.length; i++) {
					els[i].innerHTML = REAL_TANK_LBL[i];
				}
				
				
			}
			
			function widthShift() {
				var lhs = document.getElementById("left_hand_side").offsetWidth;
				var rhs = document.getElementById("right_hand_side").offsetWidth;
				if (lhs > rhs) {
					
					document.getElementById("left_hand_side").style.width = INPUT_WIDTH_AFTER;
					document.getElementById("left_hand_side").style.backgroundColor = "#63AEC1";
					document.getElementById("right_hand_side").style.width = OUTPUT_WIDTH_AFTER;
					document.getElementById("caminos_logo2").style.display = "block";
					
					$("#right_hand_side").scrollTop(0);	
				} else {
					document.getElementById("left_hand_side").style.backgroundColor = "#c9e9f2";
					document.getElementById("left_hand_side").style.width = INPUT_WIDTH_BEFORE;
					document.getElementById("right_hand_side").style.width = OUTPUT_WIDTH_BEFORE;
					document.getElementById("caminos_logo2").style.display = "none";
					$("#right_hand_side").scrollTop(0);
				};
			}
			
			
			////////////////////////////////////////////////////////////////////
			////			function inputs2outputs				 			////
			//// 															////
			////	Takes the user's entered inputs and converts them into	////
			////	outputs. This is the function that contains all of the 	////
			////	citeable-materials, it is the backbone of the actual	////
			////	calculation process.									////
			////															////
			////	Arguments:												////
			////		inputs --- a dictionary of all of the user inputs	////
			////															////	
			////	Returns:												////
			////		outputs --- a dictionary of things to display to 	////
			////					user. Fields include:					////
			////						essentialDailyUse [L/day]			////
			////						totalOtherUse [L/day]				////
			////						minTankSize [L]						////
			////						montlyUse [L] (a 1x12 array with a 	////
			////							cell for each month's use)		////
			////						monlyCollection [L] (1x12 array) 	////
			////															////
			////	Algorithm: 												////
			////		CHANTAL WILL FILL OUT THIS SECTION OF THE COMMENTS	////
			////		WITH HER USUAL FOCUS ON STYLE AND CLARITY =)		////
			////															////
			////	Update/Revision History:								////
			////		aaron krupp 	2/Nov/2016	empty function written	////	
			////									comments header written ////
			////////////////////////////////////////////////////////////////////			
			
			function inputs2outputs(inputs) {
				var outputs = {essentialDailyUse: 0,
					minTankVolume: 0,
					minRoofArea: 0,
					actualRoofArea: 0,
					actualTankVolume: 0
				};
				
				console.log(inputs)
				
				//////////////////////////////////////////////////////////////////
				//	This next sextion calculates the minimum adequate roof 		//
				//	and cistern sizes for the provided family size and area.	//
				//////////////////////////////////////////////////////////////////
				
				//variable which express the liters of drinking + liters of cooking for one person
				var essential = ESSENTIAL_DAILY_USE * (inputs.ppl);      

				var rainfall = getRainfall(inputs.place); 	// grabs rainfall from geojson data for the selected polygon. 				
				
				var testArea = 0;							// start with area of 0 (it gets bumped up to 1 in the first loop itteration);
				var testAreaAdequate = false;				// default: user doesn't have adequate roof space.
				
				if (rainfall[0]) {							// if the rainfall data has loaded:
					var test;								
					while (!testAreaAdequate) {				// while there isn't enough roof area
						testArea=testArea+1;				// increment the area
						test = getCisternSize(rainfall, testArea, EFFS[inputs.roof_type], essential) 	// get the cistern size
						testAreaAdequate = test.adequate;	// and store whether this roof is adeqaute 
					}
				} else {									// If the rainfall data hasn't loaded yet
					var test = {adequate: false, volume: 0}// 	fill with some made up data
					testArea = 99999999999999;				// This is just an outrageously large number 
				}											//	so that it will say "your roof isn't big enough!"
															//	if the user hasn't entered a roof size. 
				
				//////////////////////////////////////////////////////////////////
				//	This next sextion calculates the required minimum cistern 	//
				//	size if the user wanted to collect 100% of the water off	//
				//	their provided roof size in the average year. 				//
				//////////////////////////////////////////////////////////////////
				
				var actualArea = inputs.length * inputs.width;;
				var actual = getCisternSize(rainfall, actualArea, EFFS[inputs.roof_type], essential)
				
				outputs.essentialDailyUse = essential; 		// Water consumption for cooking & drinking [L/day]
				outputs.minTankVolume = test.volume;		// once the roof size is adequate, this is the volume of the requisite cistern [L]
				outputs.actualRoofArea = actualArea;		// the user-provided roof area [m2]
				outputs.minRoofArea = testArea;				// and this holds the minimum acceptable roof size for supporting the given population [m2]
				outputs.actualTankVolume = actual.volume;	// cistern volume required to capture 100% of rainfall on user-provided roof area [L]					
				
				return outputs 				
				
			}
			
			////////////////////////////////////////////////////////////////////
			////			function getCisternSize				 			////
			//// 															////
			////	Args:
			////		rainfall 	1x12 array with monthly rainfall [mm]	////	
			////		area		area of the roof [m2]					////
			////		eff			efficiency of roof [0,1]				////
			////		dailyUse 	household's daily avg water consumption	////
			////					[L/day]									////
			////
			////	Returns:
			////		.adequate 	tells if a roof is large enough to 		////
			////					support the provided daily use for the 	////
			////					entire year. [boolean]					////
			////		.volume		returns the cistern volume required to	////
			////					capture 100% of rainwater from the 		////
			////					provided roof area and rainfall [L].	////
			////															////
			////	Algorithm:												////
			////		Loops through all months. Calculates 				////
			////		inventory[i] = inventory[i-1] + collected[i] - use[i] //
			////		Begins this process at START_MONTH which can be set ////
			////		in globals.js. If any month has an inventory of 0,	////
			////		then .adequate returns false. otherwise, it returns	////
			////		true. 	
			////////////////////////////////////////////////////////////////////
			
			function getCisternSize(rainfall, area, eff, dailyUse) {
				var results = {adequate: true, volume: 0};
				
				var inventory = Array.apply(null, Array(DAY_MON.length)).map(Number.prototype.valueOf,0);
				for (var i=START_MONTH; i<DAY_MON.length+START_MONTH; i++) {
					var monthlyUse = dailyUse*DAY_MON[i%DAY_MON.length];							// people * L/(people*day) * day/month = [L/month]
					
					inventory[i%DAY_MON.length] = rainfall[i%DAY_MON.length]*area*eff - monthlyUse;		// mm/month * m^2 - L/month = [L/month] 			
					
					if ( i%DAY_MON.length != START_MONTH ) {					// For all months but the first one,
						if (i%DAY_MON.length == 0) {
							inventory[i%DAY_MON.length]=inventory[DAY_MON.length-1]+inventory[i%DAY_MON.length];// if january, add to inventory of december
						} else {																				//	add the current inventory to the previous. (even when its 0).
							inventory[i%DAY_MON.length]=inventory[(i-1)%DAY_MON.length]+inventory[i%DAY_MON.length];	
						}
					}																				
							
					if (inventory[i%DAY_MON.length]<0) { 							// Make sure that inventory is >=0
						inventory[i%DAY_MON.length]=0;								// 	if not, set it to zero
						results.adequate = false;						// 	and indicate that the roof space is inadequate for the family's needs
					}
				}
				//console.log("rainfall: "+rainfall)
				//console.log("area: "+area)
				//console.log("eff: "+eff)
				//console.log(inventory)
				//console.log(results.adequate)
				results.volume = Math.max.apply(null, inventory);		// The volume of the tank is the max value of the inventory.
				return results	
			}
			
			function addTooltipText(el) {
				var name = el.getAttribute("name"); 			// grab the element name
				if (name != currentTooltipName) {				// if we're on a new name	
					for(var i=0; i<el.children.length; i++) {	// loop through all children
						if (el.children[i].nodeName != "BR") {	// make sure to ignore any <br> elements
							el.children[i].innerHTML = TOOLTIP_TEXT[name];
							break;								// set the next element to the desired inner HTML
						}										//	then break out of the for-loop.
					}
				}
			}
							
			
			
			
     
		</script>
	</body>
</html>
